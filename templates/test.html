<html>
<head>
<meta charset="UTF-8" />
<title>Highcharts zhiyi | 识别量统计(zhiyitech.cn)</title>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://cdn.highcharts.com.cn/highcharts/modules/exporting.js"></script>
<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
<style>
    .container{
        margin: 100px;
        text-align: center;

    }
    .container span{
        color: green;
    }
    .container:hover{
        color: green;
    }
    a:hover{
        color: black;
    }
    .container a{
        text-decoration:none;
    }
</style>
</head>
<body>

{% if not result %}
    <h2 class="container">
    <span>该天数据不存在，请检查相关的服务，调用链路及相关中间件是否正常是否正常。</span>

    </h2>

{% endif %}
{% for i in result.keys() %}
{#    <div id="{{ i }}" ></div>#}
    <div id="{{ i }}" style="width: 1000px; height: 650px; margin: 0 auto"></div>
{#    <div style="margin:0 auto;width: 100px">#}
        <button id="large"      onclick="setSize(1000)">设置宽度为 1100px</button>
        <button id="small" onclick="setSize(550)">设置宽度为 550px</button>
        <button id="button" class="autocompare">Add  {{ i }} column</button>
{#    </div>#}

{% endfor %}
{#<div id="sysThreadChart" style="width: 550px; height: 400px; margin: 0 auto"></div>#}
{#<div id="container" style="width: 550px; height: 400px; margin: 0 auto"></div>#}
{##}
{#<div id="lineChart" style="width: 550px; height: 400px; margin: 0 auto"></div>#}

<script type="text/javascript">
    Highcharts.setOptions({
        global: { useUTC: false },
		chart: {
			events: {
				beforePrint: function () {
					this.oldhasUserSize = this.hasUserSize;
					this.resetParams = [this.chartWidth, this.chartHeight, false];
					this.setSize(600, 400, false);
				},
				afterPrint: function () {
					this.setSize.apply(this, this.resetParams);
					this.hasUserSize = this.oldhasUserSize;
				}
			}
		},
    });
    {% for i,v in result.items()%}

    var {{ i }}_chart = {
			{#chart: {#}
			{#	renderTo: '{{ i }}'//画到id为sysThreadChart的div容器里#}

            chart: {
                renderTo: '{{ i }}',//画到id为sysThreadChart的div容器里，
                events: {
                    selection: function (event) {
                        var text,
                            label;
                        if (event.xAxis) {
                            text = 'min: ' + Highcharts.numberFormat(event.xAxis[0].min, 2) + ', max: ' + Highcharts.numberFormat(event.xAxis[0].max, 2);
                        } else {
                            text = 'Selection reset';
                        }
                        label = this.renderer.label(text, 100, 120)
                            .attr({
                            fill: Highcharts.getOptions().colors[0],
                            padding: 10,
                            r: 5,
                            zIndex: 8
                        })
                            .css({
                            color: '#FFFFFF'
                        })
                            .add();
                        setTimeout(function () {
                            label.fadeOut();
                        }, 1000);
                    }
                },
                zoomType: 'x'
            },
			credits : {
				enabled:false
			},
            legend :{
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
			title: {
				text: '{{ i }} 调用量统计(interval={{ interval }})',
				style: {
					margin: '10px 100px 0 0' // center it
				},

			},
            subtitle: {
                    text: 'today_sum：{{today_sum[i]}}'
                },
            responsive: {
                rules: [{
                    condition: {
                        maxWidth: 2000
                    },
                    chartOptions: {
                        legend: {
                            align: 'center',
                            verticalAlign: 'bottom',
                            layout: 'horizontal'
                        },
                        yAxis: {
                            labels: {
                                align: 'left',
                                x: 0,
                                y: -5
                            },
                            title: {
                                text: null
                            }
                        },

                        credits: {
                            enabled: false
                        }
                    }
                }]
            },
            xAxis: {
				type:"datetime",//时间轴要加上这个type，默认是linear
				maxPadding : 0.05,
				minPadding : 0.05,
				//tickInterval : 24 * 3600 * 1000 * 2,//两天画一个x刻度
                                //或者150px画一个x刻度，如果跟上面那个一起设置了，则以最大的间隔为准
				tickPixelInterval : 150,
				tickWidth:5,//刻度的宽度
				{#lineColor : '#990000',//自定义刻度颜色#}
                 lineColor: '#808080',
				{#lineWidth :3,//自定义x轴宽度#}
				{#gridLineWidth :1,//默认是0，即在图上没有纵轴间隔线#}
				//自定义x刻度上显示的时间格式，根据间隔大小，以下面预设的小时/分钟/日的格式来显示
                                dateTimeLabelFormats:
				{
					second: '%H:%M:%S',
					minute: '%e. %b %H:%M',
					hour: '%b/%e %H:%M',
					day: '%e日/%b',
					week: '%e. %b',
					month: '%b %y',
					year: '%Y'
				}
			},
            //经测试，不能把时间值放到categories里，必须放到series的data里面去
            //这样是不行的：categories:[1274457600000,1274544000000,1274630400000]
            //时间单位是毫秒，Unix时间戳乘上1000
            yAxis: {
                title: {
                    text: 'count(个数)'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
{#                tickInterval:1, // 刻度值#}
            },
			series:{{ v[0] | safe }}
		};
    $(document).ready(function() {
            //真正的画图是这句
        chart1= new Highcharts.Chart({{ i }}_chart);
        $('#button').click(function () {
            var chart1 = $('#{{ i }}').highcharts();
            chart1.addSeries({{ v[-1][0]|safe }});
            $(this).attr('disabled', false);
            $('#button').unbind('click')
        })
    });

    {% endfor %}

    function setSize(width) {
        chart1.setSize(width, );
        chart1.setSize(width, );
    }

    function show_xy_data(data) {
        if (JSON.stringify(data)!='') {
            return data;
        }
        return null
    }

    $(function () {
        $('#lineChart').highcharts({
            title: {
                text: 'Mysql慢日志耗时监控',
                x: -20 //center
            },
            xAxis: {
                categories: show_xy_data({{ test.x_data | safe }}),
                labels:{
                    formatter: function () {
                        return Highcharts.dateFormat("%m-%d %H:%M", this.value*1000);
                    }
                }
            },
            yAxis: {
                title: {
                    text: 'count(个数)'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
{#                tickInterval:1, // 刻度值#}
            },
            series: [{
                showInLegend: false,
                data: show_xy_data({{ test.y_data | safe }}),
            }],
            credits: {
                enabled: false
            },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    events: {
                        click: function (e) {
                            e.preventDefault();
                            show_detail(e.point.category);

                        }
                    }
                }
            }
{#            lang: {#}
{#                exportButtonTitle: '导出结果',#}
{#                printButtonTile: '打印结果',#}
{#            },#}
{#            exporting: {#}
{#                enabled: true,#}
{#                type: 'image/png',#}
{#                buttons: {#}
{#                    exportButton: {#}
{#                        menuItems: [{#}
{#                            onclick: function () {#}
{#                                this.exportChart();#}
{#                            }#}
{#                        }]#}
{#                    },#}
{#                    printButton: {#}
{#                        enabled: false#}
{#                    },#}
{#                },#}
{#                filename: '报表',#}
{#                type: 'application/pdf',#}
{#            }#}
        });
    })



    $(document).ready(function() {

        var title = {
           text: '月平均气温'
        };
        var subtitle = {
            text: 'Source: runoob.com'
        };
        var xAxis = {
           categories: ['一月', '二月', '三月', '四月', '五月', '六月'
                  ,'七月', '八月', '九月', '十月', '十一月', '十二月']
        };
        var yAxis = {
          title: {
             text: 'Temperature (\xB0C)'
          },
          plotLines: [{
             value: 0,
             width: 1,
             color: '#808080'
          }]
        };

        var tooltip = {
          valueSuffix: '\xB0C'
        };

        var legend = {
          layout: 'vertical',
          align: 'right',
          verticalAlign: 'middle',
          borderWidth: 0
        };

        var series =  [
          {
             name: 'Tokyo',
             data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2,
                26.5, 23.3, 18.3, 13.9, 9.6]
          },
          {
             name: 'New York',
             data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8,
                24.1, 20.1, 14.1, 8.6, 2.5]
          },
          {
             name: 'Berlin',
             data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6,
                17.9, 14.3, 9.0, 3.9, 1.0]
          },
          {
             name: 'London',
             data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0,
                16.6, 14.2, 10.3, 6.6, 4.8]
          }
        ];

        var json = {};

        json.title = title;
        json.subtitle = subtitle;
        json.xAxis = xAxis;
        json.yAxis = yAxis;
        json.tooltip = tooltip;
        json.legend = legend;
        json.series = series;

        $('#container').highcharts(json);
});

</script>
</body>
</html>